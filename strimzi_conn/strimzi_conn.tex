%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% FILE: strimzi_conn.tex
% DESC: Displays supported connection types between 
%       different Strimzi components
%
% TODO:
%   - Refactor 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[ tikz,
                border=5mm,
                %convert={outfile=strimzi_arch.svg}
               ]{standalone}

\input{../functions/functions.tex}

%\iffalse
%\fi
\begin{document}


\begin{tikzpicture}
  \pgfmathsetmacro\diagramSize{3.0}
  \pgfmathsetmacro\midCircle{\diagramSize*2}
  \pgfmathsetmacro\structHeight{\diagramSize*0.85}
  \pgfmathsetmacro\podSize{\diagramSize*0.25}
  
  \pgfmathsetmacro\connThickness{\podSize}
  \pgfmathsetmacro\inConnThickness{\connThickness/3}
  
  \tikzstyle{S_CONN}  = [SECURE_CONN, line width=\connThickness mm]
  \tikzstyle{IS_CONN} = [INSECURE_CONN, line width=\inConnThickness mm]
  
  %\node[circle, minimum size= \midCircle cm, dotted]  (CENTER) {};
  \node[rectangle, minimum width= \midCircle cm, minimum height= \structHeight cm]  (CENTER) {};
  
  % Kafka Cluster 210
  \cluster{kc0}{\podSize}{above = 0cm of CENTER.south west, anchor=center}{3}{\kafkaPod}{\rings{Interbroker\\9091}{1} }
  % Zoo Cluster   340?
  \cluster{zc0}{\podSize}{above = 0cm of CENTER.south east, anchor=center}{3}{\zookeeper}{\rings{Internodal\\2888:3888}{2} }
  % Topic Operator
  \topicOperator{to0}{\podSize}{above = 0cm of CENTER.90, anchor=center}{}
  % CLIENT
  \pgfmathsetmacro\fontSize{\podSize * 7}
  \pgfmathsetmacro\fontSep{\podSize * 6}
  \node[ circle, 
         fill=orange, 
         text=white, 
         minimum width=\podSize cm,
         font=\fontsize{\fontSize pt}{\fontSep pt}\selectfont,
       ]  (cl0)  at ($(kc00)!0.5!(zc00)$)  {Client};
  
  \path[S_CONN]  
  (cl0) edge (kc02)
  %(cl0) edge (zc01)
  (kc02) edge (zc01)
  (to0) edge (kc02)
  (to0) edge (zc01)
  ;
  
  \path[IS_CONN]  
  %(to0) edge (kc00)
  (cl0) edge (kc00)
  ;
  
  \pgfmathsetmacro\fontSize{\podSize * 5}
  \pgfmathsetmacro\fontSep{\podSize * 4}

  \node[ above right = 0.2 cm and 0.3cm of kc00.25, 
         anchor=center, align=center,
         font=\fontsize{\fontSize pt}{\fontSep pt}\selectfont
       ] () {Client/Broker\\(Insecure)\\9092};
       
  \node[ above right = .3 cm and 0.5cm of kc02.25, 
         anchor=center, align=center,
         font=\fontsize{\fontSize pt}{\fontSep pt}\selectfont
       ] () {Client/Broker\\(Secure)\\9093};
         
  \node[ above left = .2 cm and 0.5cm of zc01.155, 
         anchor=center, align=center,
         font=\fontsize{\fontSize pt}{\fontSep pt}\selectfont
       ] () {Client/Zookeeper\\2181};
       
  \pgfmathsetmacro\legendRec{\midCircle*1.2}
  \pgfmathsetmacro\lSize{\diagramSize*0.20}
    
  \def\legendList{ \topicOperator/toL/Topic Operator, 
                   \kafkaPod/kpL/Kafka Broker Pod, 
                   \zookeeper/zL/Zookeeper Pod,
                   \tls/tL/TLS connection,
                   \nonTls/tLL/Insecure connection
                 }
  \legend{L0}{\lSize}{below = 1.5 cm of CENTER.270, anchor=center}{\legendRec}{\legendList}
  
\end{tikzpicture}

\end{document}

\documentclass[a4paper,11pt]{article}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{lmodern}
\usepackage{tikz}
\usetikzlibrary{positioning}
\usetikzlibrary{fit}
\usetikzlibrary{shapes}
\usetikzlibrary{calc}
\usetikzlibrary{matrix}
\usepackage{fontawesome} %texlive-fontawesome-doc.noarch
\usetikzlibrary{backgrounds}
\usepackage{bclogo} %texlive-bclogo-doc.noarch
%\usepackage{color}
%\usepackage[dvipsnames]{xcolor}
\usepackage{xstring}

\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}
  
\definecolor{ClusterOperatorColor}{RGB}{0,127,189}  
\definecolor{TopicOperatorColor}{RGB}{0,51,71}
\definecolor{ZookeeperColor}{RGB}{11,102,35}
\definecolor{HardwareColor}{RGB}{0,0,51}


\begin{document}

\newcommand{\kafka}[4] {% {Id}{Size}{Location}
  \initVars{kafka}{#1}{#2}{#3}
  
  \pgfmathsetmacro\msize{\kafkaSize*0.15}
  \pgfmathsetmacro\thickness{\msize*2.0}
  \pgfmathsetmacro\cthickness{\thickness*0.9} 
  \pgfmathsetmacro\dis{\msize * 0.2} 
   
  \tikzstyle{b} = [circle, inner sep=0pt, thick, line width=\thickness mm, minimum size=\msize cm]
  \tikzstyle{m} = [b, draw= black, fill = white]

  \begin{pgfonlayer}{foreground}
 
    \node[m, #3] (\kafkaId) {};
    \node[m, above = \dis cm of \kafkaId] (\kafkaId_m0) {};
    \node[m, above right = \dis cm of \kafkaId.15] (\kafkaId_m1) {};
    \node[m, below right = \dis cm of \kafkaId.345] (\kafkaId_m2) {};
    \node[m, below = \dis cm of \kafkaId] (\kafkaId_m3) {};
    \node[b, above left = \dis cm of \kafkaId.165] (\kafkaId_m4) {};

    \foreach \x/\y in {90/0,30/1, 330/2, 270/3} {
      \draw [line width=\cthickness mm] (\kafkaId.\x) edge (\kafkaId_m\y);
    }
  \end{pgfonlayer}
  %\node[fit=(\kafkaId_M)(\kafkaId_m0)(\kafkaId_m1)(\kafkaId_m2)(\kafkaId_m3)(\kafkaId_m4)] (\kafkaId) {};
}

\newcommand{\kafkaPod}[4]{% {Id}{Size}{Location}{color}
  \initVars{kafkaPod}{#1}{#2}{#3}
  \tikzstyle{kafkaPodColor} = [#4]     % #4 = color
    
  \pgfmathsetmacro\kafkaPodSize{\kafkaPodSize} 
   % Can't pass \kafkaPodLocation 
  \kafka{\kafkaPodId_0}{\kafkaPodSize}{#3}{#4}
  \pgfmathsetmacro\kafkaPodSep{- \kafkaPodSize * 2.5} 
  
  \begin{pgfonlayer}{main}
    \node[
           circle, 
           inner sep = \kafkaPodSep mm,
           minimum size = \kafkaPodSize cm,
           color=black, 
           kafkaPodColor, 
           fit=(\kafkaPodId_0)
         ] (\kafkaPodId) {};
  \end{pgfonlayer}
}

\newcommand{\disk}[4] {% {Id}{Size}{Location}{color}
  \initVars{disk}{#1}{#2}{#3}
  \tikzstyle{diskColor} = [#4] % #4 = color
  
  \pgfmathsetmacro\height{\diskSize*1.5}
  \pgfmathsetmacro\width{\diskSize*1.3}
  \pgfmathsetmacro\sep{\diskSize*1}
  \pgfmathsetmacro\shift{\diskSize*0.8}
  
  \tikzstyle{base} = [cylinder, draw, rotate = 90, thick, inner sep = \sep mm, shift={(\shift,0)}]
  \tikzstyle{vari} = [minimum height = \height cm, minimum width = \width cm, diskLocation, diskColor]
  
  \node[base, vari] (\diskId) {};
}

\newcommand{\pod}[4] {% {Id}{Size}{Location}{color}
  \initVars{pod}{#1}{#2}{#3}
  \tikzstyle{podColor} = [#4] % #4 = color
  
  \pgfmathsetmacro\ppodSize{\podSize*1.75}
  \pgfmathsetmacro\conSize{\ppodSize*0.25}

  \tikzstyle{base} = [rectangle, inner sep = 0 mm, rectangle, draw, thick]
  \tikzstyle{vari} = [minimum height = \conSize cm, minimum width = \conSize cm, podLocation, podColor]
  
  % randomly generate color for pod
  %\pgfmathparse{rnd}
  %\pgfmathtruncatemacro{\cc}{(\operatorId)*0.4}
  %\xdefinecolor{rColor}{rgb}{\cc, 0.7, \pgfmathresult}
    
  \node[base, vari] (\podId_center) {};
  
  \node[ circle, 
         thick, 
         inner sep = 0 mm, 
         minimum size= \ppodSize cm, 
         draw, 
         podColor, 
         fit=(\podId_center)
       ] (\podId) {};
  
}
\newcommand{\cube}[4] {% {Id}{Size}{Location}{color}
  \initVars{cube}{#1}{#2}{#3}
  \def\color{#4}
  
  \pgfmathsetmacro\cSize{\cubeSize*0.75}
    
  \def\x{\cSize * 0.4}
  \def\y{\cSize * 0.5}
  \def\z{\cSize * 1.0}

  \tikzstyle{coor} = [shape=coordinate]
  \node[circle, cubeLocation] (\cubeId) {};

  \node[coor, below left =\x cm and \y cm of \cubeId] (S_\cubeId) {S};
  \node[coor, above=\z cm and 0cm of S_\cubeId] (A_\cubeId) {A};
  \node[coor, above right=\y cm and \x cm of A_\cubeId] (B_\cubeId) {B};
  \node[coor, above right=\y cm and \x cm of S_\cubeId] (C_\cubeId) {C};
  \node[coor, right=0.0cm and \z cm of S_\cubeId] (D_\cubeId) {D};
  \node[coor, above=\z cm and 0.0cm of D_\cubeId] (E_\cubeId) {E};
  \node[coor, above right=\y cm and \x cm of E_\cubeId] (F_\cubeId) {F};
  \node[coor, above right=\y cm and \x cm of D_\cubeId] (G_\cubeId) {G};

  \tikzstyle{face} = [black]

  \draw[face, fill=\color!30] (S_\cubeId) -- (C_\cubeId) -- (G_\cubeId) -- (D_\cubeId) -- cycle; % Bottom Face
  \draw[face, fill=\color!30] (S_\cubeId) -- (A_\cubeId) -- (E_\cubeId) -- (D_\cubeId) -- cycle; % Back Face
  \draw[face, fill=\color!10] (S_\cubeId) -- (A_\cubeId) -- (B_\cubeId) -- (C_\cubeId) -- cycle; % Left Face
  \draw[face, fill=\color!20,opacity=0.8] (D_\cubeId) -- (E_\cubeId) -- (F_\cubeId) -- (G_\cubeId) -- cycle; % Right Face
  \draw[face, fill=\color!20,opacity=0.6] (C_\cubeId) -- (B_\cubeId) -- (F_\cubeId) -- (G_\cubeId) -- cycle; % Front Face
  \draw[face, fill=\color!20,opacity=0.8] (A_\cubeId) -- (B_\cubeId) -- (F_\cubeId) -- (E_\cubeId) -- cycle; % Top Face

  \node[coor] (\cubeId_center) at ($(S_\cubeId)!0.5!(F_\cubeId)$)  {};
  \node[coor] (\cubeId_north)  at ($(A_\cubeId)!0.5!(F_\cubeId)$)  {};
  \node[coor] (\cubeId_east)   at ($(D_\cubeId)!0.5!(F_\cubeId)$)  {};
  \node[coor] (\cubeId_south)  at ($(S_\cubeId)!0.5!(G_\cubeId)$)  {};
  \node[coor] (\cubeId_west)   at ($(S_\cubeId)!0.5!(B_\cubeId)$)  {};

  %\node[fit=(S_\cubeId)(F_\cubeId)] (\cubeId) {};
  %\tikzstyle{cube}= [fit=(S_\cubeId)(A_\cubeId)(B_\cubeId)(C_\cubeId)(D_\cubeId)(E_\cubeId)(F_\cubeId)(G_\cubeId)];
  %\node[circle, draw, cubeLocation] (test\cubeId) {};
}

\newcommand{\operator}[4] {% {Id}{Size}{Location}{color}
  \initVars{operator}{#1}{#2}{#3}
  \tikzstyle{operatorColor} = [#4] % #4 = color
  
  \pgfmathsetmacro\bodyLength{\operatorSize*1.20}
  \pgfmathsetmacro\bodyWidth{\operatorSize*0.25}
  \pgfmathsetmacro\limbLength{\bodyLength*0.70}
  \pgfmathsetmacro\limbWidth{\bodyWidth*0.55}
  \pgfmathsetmacro\armLength{\limbLength*1.75}
  \pgfmathsetmacro\operatorHeadDis{\operatorSize * 0.38}
  
  \tikzstyle{base} = [fill=black, inner sep=0pt,  minimum size = \operatorSize, operatorColor]
  
  \tikzstyle{head} = [base, circle, minimum size = \operatorSize cm]
  \tikzstyle{body} = [base, rectangle, minimum height = \bodyLength cm,  minimum width = \bodyWidth cm]
  \tikzstyle{limb} = [base, rectangle, minimum height = \limbLength cm,  minimum width = \limbWidth cm]
  \tikzstyle{arm}  = [limb, minimum height = \armLength cm]
  \tikzstyle{leg}  = [limb, rotate=90]
   
  \node[operatorLocation] (\operatorId) {};  
  \node[head, above = \operatorHeadDis cm of \operatorId.center] (head_\operatorId) {};
    
  \node[body, below = 0 cm of head_\operatorId.south] (body_\operatorId) {};
  
  %\node[arm,  rotate = 120,  above right = 0 cm of body.east, anchor = east] (r_arm) {};
  %\node[arm,  rotate = -120, above left  = 0 cm of body.west, anchor = east]  (l_arm) {};
  
  \node[arm,  rotate = 90,  above = 0cm of body_\operatorId.center, anchor = center] (arm_\operatorId) {};
  
  \node[leg, rotate = 315, below right = 0 cm of body_\operatorId.south] (r_leg_\operatorId) {};
  \node[leg, rotate = 225, below left  = 0 cm of body_\operatorId.south]  (l_leg_\operatorId) {};
  
  %\node[ 
  %      fit=(head_\operatorId)(body_\operatorId)(arm_\operatorId)(r_leg_\operatorId)(l_leg_\operatorId)
  %     ] (\operatorId_center) {};
}

\newcommand{\clusterOperator}[3] {% {Id}{Size}{Location}{color}
  \initVars{clusterOperator}{#1}{#2}{#3}
  
  \pgfmathsetmacro\coSize{\clusterOperatorSize * 0.20}
  \pgfmathsetmacro\objSize{\coSize * 0.5}
  \pgfmathsetmacro\dis{\coSize * 0.95}

  \pgfmathsetmacro\clusterOperatorSep{- \clusterOperatorSize * 1.75}
  
  \begin{pgfonlayer}{foreground}
    \operator{\clusterOperatorId}{\coSize}{clusterOperatorLocation}{color=white}
    \disk{\clusterOperatorId_d0}{\objSize}{left = \dis cm of \clusterOperatorId}{color=white}
    \pod{\clusterOperatorId_p0}{\objSize}{right = \dis cm of \clusterOperatorId}{color=white}
    %\cube{\coID_cube}{\coSize}{black}{above = \dis cm of \coID.north}; % location
  \end{pgfonlayer}
  
  \begin{pgfonlayer}{main}
    \node[ circle, 
           inner sep = \clusterOperatorSep mm,
           minimum size = \clusterOperatorSize cm,
           draw, color=white, 
           fill=ClusterOperatorColor, 
           fit=(\clusterOperatorId)
         ] (\clusterOperatorId) {};
  \end{pgfonlayer}
}

\newcommand{\topicOperator}[4] {% {Id}{Size}{Location}{color}
  \initVars{topicOperator}{#1}{#2}{#3}
  \tikzstyle{toColor} = [#4] % #4 = color
    
  \pgfmathsetmacro\toSize{\topicOperatorSize * 0.20}
  \pgfmathsetmacro\dis{\toSize * 0.85}
  \pgfmathsetmacro\scale{\toSize / 3}

  \tikzstyle{partition} = [rectangle, inner sep = 0]
  \tikzstyle{grid} = [scale=\scale, thin, draw=white]
  \operator{\topicOperatorId}{\toSize}{topicOperatorLocation}{fill=white}
  
  \begin{pgfonlayer}{foreground}
    \node (rpart) [partition, right = \dis cm of \topicOperatorId]
    {
      \tikz{\draw[grid] (0,0)  grid (1,5);}
    };
    \node (lpart) [partition, left = \dis cm of \topicOperatorId] (lpart)
    {
      \tikz{\draw[grid] (0,0)  grid (1,5);}
    };
  \end{pgfonlayer}
   
  \begin{pgfonlayer}{background}
    \node[ circle, 
           inner sep = 0 mm,
           minimum size = \topicOperatorSize cm, 
           draw, 
           color=white,
           fill=TopicOperatorColor,
           fit=(\topicOperatorId)
          ] (\topicOperatorId) {};
  \end{pgfonlayer}
}

\newcommand{\configMap}[3] {% {Id}{Size}{Location}
  \initVars{configMap}{#1}{#2}{#3}
  
  \pgfmathsetmacro\scale{\configMapSize}
  \definecolor{blueprint}{RGB}{4,63,140}

  %\draw (0,0) node (wrench) [yscale=\scale,xscale=\scale, thick, cmLocation ] {\bcoutil};
  \draw (0,0) node (wrench) [yscale=\scale, xscale=\scale, configMapLocation, color=white] {\faWrench};

  \begin{pgfonlayer}{background}
    \node[rectangle,inner sep = 0pt, fill=blueprint, draw=white, fit=(wrench)] (\configMapId) {};
  \end{pgfonlayer}
}

% Establishes consistent variable scheme by prepending all
% variables with command name
\newcommand{\initVars}[4] {% {Prefix}{Id}{Size}{Location}
  \def\Prefix{#1}
  \expandafter\def\csname \Prefix Id\endcsname{#2}
  \expandafter\def\csname \Prefix Size\endcsname{#3}
  \tikzstyle{\Prefix Location} = [#4]
}

\newcommand{\hardware}[3] {% {Id}{Size}{Location}
  \initVars{hardware}{#1}{#2}{#3}
  
  \pgfmathsetmacro\width{\hardwareSize*2.0}
  \pgfmathsetmacro\height{\hardwareSize*0.5}
  \pgfmathsetmacro\osHeight{\height*3}
  
  \tikzstyle{base} = [rectangle, rounded corners, minimum height = \height cm, minimum width = \width cm] 
  
  \node[base, fill=black!80, text=white, hardwareLocation] (\hardwareId) {\tiny Node};
  \begin{pgfonlayer}{background}
    \node [ base, 
            fill=gray!80, 
            text=white, 
            above = 0cm of \hardwareId.north, 
            minimum height = \osHeight cm
          ] (\hardwareId_openshift) {};
  \end{pgfonlayer}
  \node[above = 0cm of \hardwareId_openshift.south, text=white] () {\tiny OpenShift};
}

\newcommand{\zookeeper}[3] { %{Id}{Size}{Location}
  \initVars{zookeeper}{#1}{#2}{#3}
  \pgfmathsetmacro\scale{\zookeeperSize}
  \pgfmathsetmacro\zookeeperFontSize{\zookeeperSize * 15}

  \node[ minimum width= \zookeeperSize cm, 
         circle, 
         fill=ZookeeperColor, 
         outer sep=0mm, 
         minimum size=\zookeeperSize cm,
         font=\fontsize{\zookeeperFontSize}{0}\selectfont,
         text=white, 
         zookeeperLocation
       ] (\zookeeperId) {Z};
}
  
\newcommand{\legend}[3] { %{Id}{Size}{Location}
  \initVars{legend}{#1}{#2}{#3}
  \pgfmathsetmacro\legendDis{\legendSize * 1.5}
 
  \node[legendLocation] (LOC) {Legend};
  
  \clusterOperator{coL}{\legendSize}{below = 0.4 * \legendDis cm of LOC}{}
  \node[right = 0.25 cm of coL] (coL_label) {Cluster Operator};
  
  \topicOperator{toL}{\legendSize}{below = 1.2 * \legendDis cm of LOC}{}
  \node[right = 0.25 cm of toL] (to_label) {Topic Operator};
  
  \kafkaPod{kpL}{\legendSize}{below = 2.0 * \legendDis cm of LOC}{fill=yellow}
  \node[right = 0.25 cm of kpL] (kpL_label) {Kafka Broker Pod};
  
  \zookeeper{zL}{\legendSize}{below = 2.5 * \legendDis cm of LOC}
  \node[right = 0.25 cm of zL] (zL_label) {Zookeeper Pod};
 
  \configMap{cmL}{\legendSize}{below = 3.25 * \legendDis cm of LOC}
  \node[right = 0.25 cm of cmL] (cmL_label) {ConfigMap};
  
  \node[draw, dotted, thick, fit=(coL)(toL)(kpL)(zL)(kpL_label)(cmL)] () {};
}

  
\begin{tikzpicture}

  \clusterOperator{co0}{2}{}{}
  \topicOperator{to0}{2}{right = 2 cm of co0.center}{}
  \kafkaPod{kp0}{2}{right = 2  cm of to0.center}{fill=yellow}
  \topicOperator{to0}{2}{right = 2 cm of co0.center}{}
  \zookeeper{zk0}{2}{right = 1.25  cm of kp0.center}{}
  \configMap{cm0}{2}{right = 1.25  cm of zk0.center}{}
  %\node[draw=black, dotted, fit=(co0)(to0)(kp0)(zk0)] () {};
  %\testt{f}
  %  \hardware{hw0}{1.0}{}
  %\cube{ww}{10}{}{blue}
  %\kafkaPod{www}{1}{}{}
  %\kafka{KKK}{1}{}
\end{tikzpicture}

%\iffalse
\begin{tikzpicture}

  \hardware{hw0}{1.0}{}
  \pgfmathsetmacro\diagramSize{.8}
  
  \clusterOperator{co0}{\diagramSize}{right = 0.35cm of hw0_openshift.center}{}
  \configMap{cm0}{0.9}{left = 0.85cm of co0.center}
  
  \hardware{hw1}{1.0}{right = 1cm of hw0}
  \topicOperator{to0}{\diagramSize}{right = 0.35cm of hw1_openshift.center}{}
  \configMap{cm1}{0.9}{left = 0.85cm of to0.center}
  
  \hardware{hw2}{1.0}{above right = 4.5cm and 1cm of hw1}
  \kafkaPod{kp0}{\diagramSize}{right = 0.45cm of hw2_openshift.mid}{fill=yellow}
  \zookeeper{z0}{\diagramSize}{left = 0.15cm of hw2_openshift.mid}
  
  \hardware{hw3}{1.0}{below = 2cm of hw2}
  \kafkaPod{kp1}{\diagramSize}{right = 0.45cm of hw3_openshift.mid}{fill=yellow}
  \zookeeper{z1}{\diagramSize}{left = 0.15cm of hw3_openshift.mid}
  
  \hardware{hw4}{1.0}{below = 2cm of hw3}
  \kafkaPod{kp2}{\diagramSize}{right = 0.45cm of hw4_openshift.mid}{fill=yellow}
  \zookeeper{z2}{\diagramSize}{left = 0.15cm of hw4_openshift.mid}
  
  \node[draw, dotted, thick, inner sep = 1 mm, fit=(z0)(z1)(z2)] (ss0) {};
  \node[draw, dotted, thick, inner sep = 1 mm, fit=(kp0)(kp1)(kp2)] (ss1) {};
  
  \node[below = 1.25cm of to0] (place0) {};
  \node[below = 1.50cm of ss0] (place1) {};
  \node[below = 1.75cm of ss1] (place2) {};
  
  \draw [->]  (co0.165) -- (cm0.22);
  \draw [->]  (cm0.345) -- (co0.195);

  \draw [->]  (to0.165) -- (cm1.22);
  \draw [->]  (cm1.345) -- (to0.195);
  
  %\node[circle, dotted, minimum width = 7cm, draw=black, fit=(hw0)(hw1)] (T) {};
  
  %\path[->, thin, to path={|- (\tikztotarget)}]
  %  (co0.320) edge (place0.center)
  %  (place0.center) edge (to0.south)
  %  (co0.280) edge (place1.center)
  %  (place1.center) edge (ss0.south)
  %  (co0.250) edge (place2.center)
  %  (place2.center) edge (ss1.south);
     
  %\path[->, thin, to path={-| (\tikztotarget)}]
   %(to0.north) edge (kp0.135)
   %(to0.north) edge (z0.190)
  % (to0.north) edge (kp1.south)
  % (to0.north) edge (z1.south)
  % (to0.north) edge (kp2.north)
  % (to0.north) edge (z2.north);
   
  %\path[->, thin, to path={|- (\tikztotarget)}]
  % (to0.north) edge (kp0.south)
  % (to0.120) edge (z0.190);
  
  \legend{L0}{1}{above right = 2cm and 1.0cm of hw2}
  
  \node[ above right = 3.5cm and -1.5cm of hw0,  
         align=center, 
         font=\bfseries
       ] (Title) {\Huge Strimzi\\Kafka Operator\\Architecture};

\end{tikzpicture}
 %\fi

 % ConfigMap sizing
 % Fix zookeeper sizing
 % Diagram orientation
 % Nodes as part of circle

  
\end{document}
